<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HRM Fiddle</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-MfvZlkHCEqatNoGiOXveE8FIwMzZg4W85qfrfIFBfYc= sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="https://cdn.rawgit.com/sixlettervariables/hrmsandbox/b2d5a5f457021b6c993aa301ebc1321662443a49/build/hrm-browser.min.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <style type="text/css">
  textarea {
    font-family: monospace;
    width: 100%;
    height: auto;
  }
  </style>
</head>
<body>
<header class="container">
  <h1>HRM Program Sandbox</h1>
  <p>I don't work for <a href="http://tomorrowcorporation.com">Tommorow Corporation</a>,
    nor did I work on <a href="http://tomorrowcorporation.com/humanresourcemachine">Human Resource Machine</a>. But I sure do love the game.</p>
  <p>HRM Sandbox provides a place to try and share programs. Tomorrow Corporation didn't sponsor this, nor condone it, nor are they likely aware of it.</p>
</header>
<section class="container">
  <div class="program col-lg-6 col-md-6 col-sm-12">
    <h1>Program</h1>
    <textarea id="program" class="form-control" rows="20" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
-- HUMAN RESOURCE MACHINE PROGRAM --

a:
  inbox
  add 9
  copyto 0
  bumpup 0
  copyfrom [8]
  outbox
  jump a
    </textarea>
    <div class="alert alert-danger hidden" role="alert" id="error"></div>
    <button id="run" class="btn btn-primary">Run</button>
  </div>
  <div class="inputs col-lg-3 col-md-3 col-sm-6">
   <h2>Inbox</h2>
   <em>(one per line, read top to bottom)</em>
   <textarea id="inbox" class="form-control" rows="5" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">1
2
3
4</textarea>
  <h2>Variables</h2>
  <em>(JSON)</em><br />
  <textarea id="variables" class="form-control" rows="5"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">{
  "8": 0,
  "9": -3
}</textarea>
  </div>
  <div class="outputs col-lg-3 col-md-3 col-sm-6">
    <h2>Outbox</h2>
    <em>(one per line, topmost is last)</em>
    <ul id="outbox" class="list-unstyled">
    </ul>
  </div>
</section>
<section class="container">
  <h2><a id="user-content-hrm-sandbox-instruction-set" class="anchor" href="#hrm-sandbox-instruction-set" aria-hidden="true"></a>HRM Sandbox Instruction Set</h2>
  <table class="table table-striped"><thead>
  <tr>
  <th>Instruction</th>
  <th>Description</th>
  </tr>
  </thead><tbody>
  <tr>
  <td><code>inbox</code></td>
  <td>Takes the value from the top of the inbox and places it in your hand</td>
  </tr>
  <tr>
  <td><code>outbox</code></td>
  <td>Takes the value from your hand and places it on the top of the inbox</td>
  </tr>
  <tr>
  <td><code>copyto 4</code></td>
  <td>Copies the value in your hand into <code>4</code></td>
  </tr>
  <tr>
  <td><code>copyfrom 1</code></td>
  <td>Copies the value from <code>4</code> into your hand</td>
  </tr>
  <tr>
  <td><code>add 2</code></td>
  <td>Adds the value in your hand to the value in <code>2</code></td>
  </tr>
  <tr>
  <td><code>sub 3</code></td>
  <td>Subtracts from the value in your hand the value in <code>3</code></td>
  </tr>
  <tr>
  <td><code>bumpup 1</code></td>
  <td>Increments the value in <code>1</code> by one (1), saving it into <code>1</code> and your hand</td>
  </tr>
  <tr>
  <td><code>bumpdn 0</code></td>
  <td>Decrements the value in <code>0</code> by one (1), saving it into <code>0</code> and your hand</td>
  </tr>
  <tr>
  <td><code>jump label</code></td>
  <td>Jumps to <code>label</code></td>
  </tr>
  <tr>
  <td><code>jumpz label</code></td>
  <td>Jumps to <code>label</code> if the value in your hand is zero (0)</td>
  </tr>
  <tr>
  <td><code>jumpn label</code></td>
  <td>Jumps to <code>label</code> if the value in your hand is negative</td>
  </tr>
  </tbody></table>
</section>
<footer class="container">
<p><a href="https://github.com/sixlettervariables/hrmsandbox">HRM Sandbox</a> by <a href="mailto:Christopher.watford@gmail.com">Christopher A. Watford</a></p>
</footer>
<script type="text/javascript">
var hrm = require('hrmsandbox');
$(document).ready(function() {
  $('#run').on('click', function () {
    console.log('run');
    $('#error').empty();
    try {
      var source = $('#program').val();
      var inbox = $('#inbox').val().split(/\n/).filter(function (v) { return v.trim().length > 0; }).map(function (s) {
        var n = Number(s);
        return Number.isNaN(n) ? s : n;
      });
      var variables = $.parseJSON($('#variables').val());
      var program = hrm.parse(source);
      var results = program.execute({ inbox: inbox, variables: variables });
      if (results && results.outbox) {
        $('#outbox').empty();
        for (var ii = 0; ii < results.outbox.length; ++ii) {
          $('#outbox').append(
              $('<li>').append(
                results.outbox[ii].toString()
              ));
        }
      }
      $('#error').toggleClass('hidden', true);
    } catch(error) {
      console.error(error);
      $('#error').toggleClass('hidden', false);
      if (error.name && error.name === 'SyntaxError') {
        var loc = error.location.start;
        $('#error').append('<b>Error parsing HRM program, aborted.</b><br />' +
          'Line ' + loc.line + ' Column ' + loc.column + '<br />' +
          error.message
        );
      }
      else {
        $('#error').append('<b>Error running HRM program, aborted.</b><br />' +
          error.message
        );
      }
    }
  });
});
</script>
</body>
</html>
