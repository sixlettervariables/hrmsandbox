/*! hrmsandbox - v0.8.0 - 2015-11-10 */function HRMLabel(encoded_label,height,width,brush_diameter){"use strict";function rescale(x,oldmax,newmax){return x*newmax/oldmax}this.height=height||40,this.width=width||3*this.height,this.brush_diameter=brush_diameter||this.height/11;for(var hrm_max=65535,zlib=window.atob(encoded_label),zlibu8=new Uint8Array(zlib.length),i=0;i<zlib.length;i++)zlibu8[i]=zlib.charCodeAt(i);var raw=pako.inflate(zlibu8),dv=new DataView(raw.buffer),elements=dv.getUint16(0,!0),points=[];this.strokes=[];for(var min_x=this.width,max_x=0,min_y=this.height,max_y=0,i=0;elements>i&&4*i+6<=raw.length;i++){var index=4*i+4,x=dv.getUint16(index,!0),y=dv.getUint16(index+2,!0);0==x&&0==y?(this.strokes.push(points),points=[]):(x=rescale(x,hrm_max,this.width),y=rescale(y,hrm_max,this.height),points.push([x,y]),max_x=Math.max(max_x,x),min_x=Math.min(min_x,x),max_y=Math.max(max_y,y),min_y=Math.min(min_y,y))}this.extents={min_x:Math.max(min_x-this.brush_diameter/2,0),min_y:Math.max(min_y-this.brush_diameter/2,0),max_x:Math.min(max_x+this.brush_diameter/2,this.width),max_y:Math.min(max_y+this.brush_diameter/2,this.height)},this.extents.width=this.extents.max_x-this.extents.min_x,this.extents.height=this.extents.max_y-this.extents.min_y}function HRMParser(lines){"use strict";function is_code(cmd){return"invalid"==cmd||"blank"==cmd||"jumpdst"==cmd||"asm_comment"==cmd||"comment"==cmd?0:1}function tokenize_line(line){var match,re_asm_comment=/^--/,re_jump_dst=/^(\S+):/,re_whitespace=/\s+/;if(line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),""==line)return["blank"];if(match=re_jump_dst.exec(line))return["jumpdst",match[1]];if(re_asm_comment.test(line))return["asm_comment",line];var tokens=line.split(re_whitespace),cmd=tokens[0].toLowerCase(),onearg=["copyfrom","copyto","bumpup","bumpdn","jump","jumpn","jumpz","add","sub","comment"],zeroarg=["inbox","outbox"];if(2==tokens.length){for(var i=0;i<onearg.length;i++)if(cmd==onearg[i])return[cmd,tokens[1]]}else if(1==tokens.length)for(var i=0;i<zeroarg.length;i++)if(cmd==zeroarg[i])return[cmd];return["invalid",line]}"string"==typeof lines&&(lines=lines.split(/\r?\n/));var line_number_offset=0;"-- HUMAN RESOURCE MACHINE PROGRAM --"==lines[0]&&(lines.shift(),line_number_offset++);var parts=this.extract_labels(lines);this.comments=parts.labels.comment,this.labels=parts.labels.label;var asm_lines=parts.olines;this.code=[];for(var tokens,lineobj,code_line_num=0,line=0;line<asm_lines.length;line++)tokens=tokenize_line(asm_lines[line]),lineobj={cmd:tokens[0],src_line_num:line+line_number_offset},is_code(lineobj.cmd)&&(code_line_num++,lineobj.line_num=code_line_num),2==tokens.length&&(lineobj.arg=tokens[1]),this.code.push(lineobj)}function HRMViewer(id,source){"use strict";void 0!==id&&(source.indexOf("\n")>=0?this.append_code_table(id,source):this.download_and_append_code_table(id,source))}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.pako=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var TYPED_OK="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;exports.assign=function(obj){for(var sources=Array.prototype.slice.call(arguments,1);sources.length;){var source=sources.shift();if(source){if("object"!=typeof source)throw new TypeError(source+"must be non-object");for(var p in source)source.hasOwnProperty(p)&&(obj[p]=source[p])}}return obj},exports.shrinkBuf=function(buf,size){return buf.length===size?buf:buf.subarray?buf.subarray(0,size):(buf.length=size,buf)};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray)return void dest.set(src.subarray(src_offs,src_offs+len),dest_offs);for(var i=0;len>i;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;for(len=0,i=0,l=chunks.length;l>i;i++)len+=chunks[i].length;for(result=new Uint8Array(len),pos=0,i=0,l=chunks.length;l>i;i++)chunk=chunks[i],result.set(chunk,pos),pos+=chunk.length;return result}},fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;len>i;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){on?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,fnTyped)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,fnUntyped))},exports.setTyped(TYPED_OK)},{}],2:[function(require,module,exports){"use strict";function buf2binstring(buf,len){if(65537>len&&(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len));for(var result="",i=0;len>i;i++)result+=String.fromCharCode(buf[i]);return result}var utils=require("./common"),STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils.Buf8(256),q=0;256>q;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1,exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;str_len>m_pos;m_pos++)c=str.charCodeAt(m_pos),55296===(64512&c)&&str_len>m_pos+1&&(c2=str.charCodeAt(m_pos+1),56320===(64512&c2)&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++)),buf_len+=128>c?1:2048>c?2:65536>c?3:4;for(buf=new utils.Buf8(buf_len),i=0,m_pos=0;buf_len>i;m_pos++)c=str.charCodeAt(m_pos),55296===(64512&c)&&str_len>m_pos+1&&(c2=str.charCodeAt(m_pos+1),56320===(64512&c2)&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++)),128>c?buf[i++]=c:2048>c?(buf[i++]=192|c>>>6,buf[i++]=128|63&c):65536>c?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c);return buf},exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)},exports.binstring2buf=function(str){for(var buf=new utils.Buf8(str.length),i=0,len=buf.length;len>i;i++)buf[i]=str.charCodeAt(i);return buf},exports.buf2string=function(buf,max){var i,out,c,c_len,len=max||buf.length,utf16buf=new Array(2*len);for(out=0,i=0;len>i;)if(c=buf[i++],128>c)utf16buf[out++]=c;else if(c_len=_utf8len[c],c_len>4)utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;c_len>1&&len>i;)c=c<<6|63&buf[i++],c_len--;c_len>1?utf16buf[out++]=65533:65536>c?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return buf2binstring(utf16buf,out)},exports.utf8border=function(buf,max){var pos;for(max=max||buf.length,max>buf.length&&(max=buf.length),pos=max-1;pos>=0&&128===(192&buf[pos]);)pos--;return 0>pos?max:0===pos?max:pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":1}],3:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){for(var s1=65535&adler|0,s2=adler>>>16&65535|0,n=0;0!==len;){n=len>2e3?2e3:len,len-=n;do s1=s1+buf[pos++]|0,s2=s2+s1|0;while(--n);s1%=65521,s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],4:[function(require,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(require,module,exports){"use strict";function makeTable(){for(var c,table=[],n=0;256>n;n++){c=n;for(var k=0;8>k;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return table}function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc=-1^crc;for(var i=pos;end>i;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc}var crcTable=makeTable();module.exports=crc32},{}],6:[function(require,module,exports){"use strict";function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}module.exports=GZheader},{}],7:[function(require,module,exports){"use strict";var BAD=30,TYPE=12;module.exports=function(strm,start){var state,_in,last,_out,beg,end,dmax,wsize,whave,wnext,s_window,hold,bits,lcode,dcode,lmask,dmask,here,op,len,dist,from,from_source,input,output;state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,s_window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{15>bits&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];dolen:for(;;){if(op=here>>>24,hold>>>=op,bits-=op,op=here>>>16&255,0===op)output[_out++]=65535&here;else{if(!(16&op)){if(0===(64&op)){here=lcode[(65535&here)+(hold&(1<<op)-1)];continue dolen}if(32&op){state.mode=TYPE;break top}strm.msg="invalid literal/length code",state.mode=BAD;break top}len=65535&here,op&=15,op&&(op>bits&&(hold+=input[_in++]<<bits,bits+=8),len+=hold&(1<<op)-1,hold>>>=op,bits-=op),15>bits&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];dodist:for(;;){if(op=here>>>24,hold>>>=op,bits-=op,op=here>>>16&255,!(16&op)){if(0===(64&op)){here=dcode[(65535&here)+(hold&(1<<op)-1)];continue dodist}strm.msg="invalid distance code",state.mode=BAD;break top}if(dist=65535&here,op&=15,op>bits&&(hold+=input[_in++]<<bits,bits+=8,op>bits&&(hold+=input[_in++]<<bits,bits+=8)),dist+=hold&(1<<op)-1,dist>dmax){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(hold>>>=op,bits-=op,op=_out-beg,dist>op){if(op=dist-op,op>whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(from=0,from_source=s_window,0===wnext){if(from+=wsize-op,len>op){len-=op;do output[_out++]=s_window[from++];while(--op);from=_out-dist,from_source=output}}else if(op>wnext){if(from+=wsize+wnext-op,op-=wnext,len>op){len-=op;do output[_out++]=s_window[from++];while(--op);if(from=0,len>wnext){op=wnext,len-=op;do output[_out++]=s_window[from++];while(--op);from=_out-dist,from_source=output}}}else if(from+=wnext-op,len>op){len-=op;do output[_out++]=s_window[from++];while(--op);from=_out-dist,from_source=output}for(;len>2;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len-=3;len&&(output[_out++]=from_source[from++],len>1&&(output[_out++]=from_source[from++]))}else{from=_out-dist;do output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],len-=3;while(len>2);len&&(output[_out++]=output[from++],len>1&&(output[_out++]=output[from++]))}break}}break}}while(last>_in&&end>_out);len=bits>>3,_in-=len,bits-=len<<3,hold&=(1<<bits)-1,strm.next_in=_in,strm.next_out=_out,strm.avail_in=last>_in?5+(last-_in):5-(_in-last),strm.avail_out=end>_out?257+(end-_out):257-(_out-end),state.hold=hold,state.bits=bits}},{}],8:[function(require,module,exports){"use strict";function ZSWAP32(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils.Buf16(320),this.work=new utils.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(strm){var state;return strm&&strm.state?(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=1&state.wrap),state.mode=HEAD,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS),state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS),state.sane=1,state.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(strm){var state;return strm&&strm.state?(state=strm.state,state.wsize=0,state.whave=0,state.wnext=0,inflateResetKeep(strm)):Z_STREAM_ERROR}function inflateReset2(strm,windowBits){var wrap,state;return strm&&strm.state?(state=strm.state,0>windowBits?(wrap=0,windowBits=-windowBits):(wrap=(windowBits>>4)+1,48>windowBits&&(windowBits&=15)),windowBits&&(8>windowBits||windowBits>15)?Z_STREAM_ERROR:(null!==state.window&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))):Z_STREAM_ERROR}function inflateInit2(strm,windowBits){var ret,state;return strm?(state=new InflateState,strm.state=state,state.window=null,ret=inflateReset2(strm,windowBits),ret!==Z_OK&&(strm.state=null),ret):Z_STREAM_ERROR}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}function fixedtables(state){if(virgin){var sym;for(lenfix=new utils.Buf32(512),distfix=new utils.Buf32(32),sym=0;144>sym;)state.lens[sym++]=8;for(;256>sym;)state.lens[sym++]=9;for(;280>sym;)state.lens[sym++]=7;for(;288>sym;)state.lens[sym++]=8;for(inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;32>sym;)state.lens[sym++]=5;inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}function updatewindow(strm,src,end,copy){var dist,state=strm.state;return null===state.window&&(state.wsize=1<<state.wbits,state.wnext=0,state.whave=0,state.window=new utils.Buf8(state.wsize)),copy>=state.wsize?(utils.arraySet(state.window,src,end-state.wsize,state.wsize,0),state.wnext=0,state.whave=state.wsize):(dist=state.wsize-state.wnext,dist>copy&&(dist=copy),utils.arraySet(state.window,src,end-copy,dist,state.wnext),copy-=dist,copy?(utils.arraySet(state.window,src,end-copy,copy,0),state.wnext=copy,state.whave=state.wsize):(state.wnext+=dist,state.wnext===state.wsize&&(state.wnext=0),state.whave<state.wsize&&(state.whave+=dist))),0}function inflate(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here_bits,here_op,here_val,last_bits,last_op,last_val,len,ret,opts,n,here=0,hbuf=new utils.Buf8(4),order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&0!==strm.avail_in)return Z_STREAM_ERROR;state=strm.state,state.mode===TYPE&&(state.mode=TYPEDO),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=Z_OK;inf_leave:for(;;)switch(state.mode){case HEAD:if(0===state.wrap){state.mode=TYPEDO;break}for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(2&state.wrap&&35615===hold){state.check=0,hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0),hold=0,bits=0,state.mode=FLAGS;break}if(state.flags=0,state.head&&(state.head.done=!1),!(1&state.wrap)||(((255&hold)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=BAD;break}if((15&hold)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(hold>>>=4,bits-=4,len=(15&hold)+8,0===state.wbits)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size",state.mode=BAD;break}state.dmax=1<<len,strm.adler=state.check=1,state.mode=512&hold?DICTID:TYPE,hold=0,bits=0;break;case FLAGS:for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,(255&state.flags)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(57344&state.flags){strm.msg="unknown header flags set",state.mode=BAD;break}state.head&&(state.head.text=hold>>8&1),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=TIME;case TIME:for(;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32(state.check,hbuf,4,0)),hold=0,bits=0,state.mode=OS;case OS:for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=255&hold,state.head.os=hold>>8),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=EXLEN;case EXLEN:if(1024&state.flags){for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0}else state.head&&(state.head.extra=null);state.mode=EXTRA;case EXTRA:if(1024&state.flags&&(copy=state.length,copy>have&&(copy=have),copy&&(state.head&&(len=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),utils.arraySet(state.head.extra,input,next,copy,len)),512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=NAME;case NAME:if(2048&state.flags){if(0===have)break inf_leave;copy=0;do len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.name+=String.fromCharCode(len));while(len&&have>copy);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=COMMENT;case COMMENT:if(4096&state.flags){if(0===have)break inf_leave;copy=0;do len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.comment+=String.fromCharCode(len));while(len&&have>copy);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.comment=null);state.mode=HCRC;case HCRC:if(512&state.flags){for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(65535&state.check)){strm.msg="header crc mismatch",state.mode=BAD;break}hold=0,bits=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=TYPE;break;case DICTID:for(;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=ZSWAP32(hold),hold=0,bits=0,state.mode=DICT;case DICT:if(0===state.havedict)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,Z_NEED_DICT;strm.adler=state.check=1,state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES)break inf_leave;case TYPEDO:if(state.last){hold>>>=7&bits,bits-=7&bits,state.mode=CHECK;break}for(;3>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=1&hold,hold>>>=1,bits-=1,3&hold){case 0:state.mode=STORED;break;case 1:if(fixedtables(state),state.mode=LEN_,flush===Z_TREES){hold>>>=2,bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type",state.mode=BAD}hold>>>=2,bits-=2;break;case STORED:for(hold>>>=7&bits,bits-=7&bits;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((65535&hold)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=BAD;break}if(state.length=65535&hold,hold=0,bits=0,state.mode=COPY_,flush===Z_TREES)break inf_leave;case COPY_:state.mode=COPY;case COPY:if(copy=state.length){if(copy>have&&(copy=have),copy>left&&(copy=left),0===copy)break inf_leave;utils.arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=TYPE;break;case TABLE:for(;14>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=(31&hold)+257,hold>>>=5,bits-=5,state.ndist=(31&hold)+1,hold>>>=5,bits-=5,state.ncode=(15&hold)+4,hold>>>=4,bits-=4,state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols",state.mode=BAD;break}state.have=0,state.mode=LENLENS;case LENLENS:for(;state.have<state.ncode;){for(;3>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=7&hold,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=BAD;break}state.have=0,state.mode=CODELENS;case CODELENS:for(;state.have<state.nlen+state.ndist;){for(;here=state.lencode[hold&(1<<state.lenbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(16>here_val)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(16===here_val){for(n=here_bits+2;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,0===state.have){strm.msg="invalid bit length repeat",state.mode=BAD;break}len=state.lens[state.have-1],copy=3+(3&hold),hold>>>=2,bits-=2}else if(17===here_val){for(n=here_bits+3;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=here_bits,bits-=here_bits,len=0,copy=3+(7&hold),hold>>>=3,bits-=3}else{for(n=here_bits+7;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=here_bits,bits-=here_bits,len=0,copy=11+(127&hold),hold>>>=7,bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=BAD;break}for(;copy--;)state.lens[state.have++]=len}}if(state.mode===BAD)break;if(0===state.lens[256]){strm.msg="invalid code -- missing end-of-block",state.mode=BAD;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=BAD;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=BAD;break}if(state.mode=LEN_,flush===Z_TREES)break inf_leave;case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,inflate_fast(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,state.mode===TYPE&&(state.back=-1);break}for(state.back=0;here=state.lencode[hold&(1<<state.lenbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&0===(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=last_bits+here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,0===here_op){state.mode=LIT;break}if(32&here_op){state.back=-1,state.mode=TYPE;break}if(64&here_op){strm.msg="invalid literal/length code",state.mode=BAD;break}state.extra=15&here_op,state.mode=LENEXT;case LENEXT:if(state.extra){for(n=state.extra;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=DIST;case DIST:for(;here=state.distcode[hold&(1<<state.distbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(0===(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=last_bits+here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,64&here_op){strm.msg="invalid distance code",state.mode=BAD;break}state.offset=here_val,state.extra=15&here_op,state.mode=DISTEXT;case DISTEXT:if(state.extra){for(n=state.extra;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=BAD;break}state.mode=MATCH;case MATCH:if(0===left)break inf_leave;if(copy=_out-left,state.offset>copy){if(copy=state.offset-copy,copy>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break}copy>state.wnext?(copy-=state.wnext,from=state.wsize-copy):from=state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;copy>left&&(copy=left),left-=copy,state.length-=copy;do output[put++]=from_source[from++];while(--copy);0===state.length&&(state.mode=LEN);break;case LIT:if(0===left)break inf_leave;output[put++]=state.length,left--,state.mode=LEN;break;case CHECK:if(state.wrap){for(;32>bits;){if(0===have)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:ZSWAP32(hold))!==state.check){strm.msg="incorrect data check",state.mode=BAD;break}hold=0,bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){for(;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(4294967295&state.total)){strm.msg="incorrect length check",state.mode=BAD;break}hold=0,bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH))&&updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)?(state.mode=MEM,Z_MEM_ERROR):(_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0),(0===_in&&0===_out||flush===Z_FINISH)&&ret===Z_OK&&(ret=Z_BUF_ERROR),ret)}function inflateEnd(strm){if(!strm||!strm.state)return Z_STREAM_ERROR;var state=strm.state;return state.window&&(state.window=null),strm.state=null,Z_OK}function inflateGetHeader(strm,head){var state;return strm&&strm.state?(state=strm.state,0===(2&state.wrap)?Z_STREAM_ERROR:(state.head=head,head.done=!1,Z_OK)):Z_STREAM_ERROR}var lenfix,distfix,utils=require("../utils/common"),adler32=require("./adler32"),crc32=require("./crc32"),inflate_fast=require("./inffast"),inflate_table=require("./inftrees"),CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,virgin=!0;exports.inflateReset=inflateReset,exports.inflateReset2=inflateReset2,exports.inflateResetKeep=inflateResetKeep,exports.inflateInit=inflateInit,exports.inflateInit2=inflateInit2,exports.inflate=inflate,exports.inflateEnd=inflateEnd,exports.inflateGetHeader=inflateGetHeader,exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(require,module,exports){"use strict";var utils=require("../utils/common"),MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function(type,lens,lens_index,codes,table,table_index,work,opts){var incr,fill,low,mask,next,end,here_bits,here_op,here_val,bits=opts.bits,len=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,base=null,base_index=0,count=new utils.Buf16(MAXBITS+1),offs=new utils.Buf16(MAXBITS+1),extra=null,extra_index=0;for(len=0;MAXBITS>=len;len++)count[len]=0;for(sym=0;codes>sym;sym++)count[lens[lens_index+sym]]++;for(root=bits,max=MAXBITS;max>=1&&0===count[max];max--);if(root>max&&(root=max),0===max)return table[table_index++]=20971520,table[table_index++]=20971520,opts.bits=1,0;for(min=1;max>min&&0===count[min];min++);for(min>root&&(root=min),left=1,len=1;MAXBITS>=len;len++)if(left<<=1,left-=count[len],0>left)return-1;if(left>0&&(type===CODES||1!==max))return-1;for(offs[1]=0,len=1;MAXBITS>len;len++)offs[len+1]=offs[len]+count[len];for(sym=0;codes>sym;sym++)0!==lens[lens_index+sym]&&(work[offs[lens[lens_index+sym]]++]=sym);if(type===CODES?(base=extra=work,end=19):type===LENS?(base=lbase,base_index-=257,extra=lext,extra_index-=257,end=256):(base=dbase,extra=dext,end=-1),huff=0,sym=0,len=min,next=table_index,curr=root,drop=0,low=-1,used=1<<root,mask=used-1,type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;for(var i=0;;){i++,here_bits=len-drop,work[sym]<end?(here_op=0,here_val=work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],here_val=base[base_index+work[sym]]):(here_op=96,here_val=0),incr=1<<len-drop,fill=1<<curr,min=fill;do fill-=incr,table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0;while(0!==fill);for(incr=1<<len-1;huff&incr;)incr>>=1;if(0!==incr?(huff&=incr-1,
huff+=incr):huff=0,sym++,0===--count[len]){if(len===max)break;len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){for(0===drop&&(drop=root),next+=min,curr=len-drop,left=1<<curr;max>curr+drop&&(left-=count[curr+drop],!(0>=left));)curr++,left<<=1;if(used+=1<<curr,type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;low=huff&mask,table[low]=root<<24|curr<<16|next-table_index|0}}return 0!==huff&&(table[next+huff]=len-drop<<24|64<<16|0),opts.bits=root,0}},{"../utils/common":1}],10:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(require,module,exports){"use strict";function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}module.exports=ZStream},{}],"/lib/inflate.js":[function(require,module,exports){"use strict";function inflate(input,options){var inflator=new Inflate(options);if(inflator.push(input,!0),inflator.err)throw inflator.msg;return inflator.result}function inflateRaw(input,options){return options=options||{},options.raw=!0,inflate(input,options)}var zlib_inflate=require("./zlib/inflate.js"),utils=require("./utils/common"),strings=require("./utils/strings"),c=require("./zlib/constants"),msg=require("./zlib/messages"),zstream=require("./zlib/zstream"),gzheader=require("./zlib/gzheader"),toString=Object.prototype.toString,Inflate=function(options){this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>=0&&opt.windowBits<16&&(opt.windowBits=-opt.windowBits,0===opt.windowBits&&(opt.windowBits=-15)),!(opt.windowBits>=0&&opt.windowBits<16)||options&&options.windowBits||(opt.windowBits+=32),opt.windowBits>15&&opt.windowBits<48&&0===(15&opt.windowBits)&&(opt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK)throw new Error(msg[status]);this.header=new gzheader,zlib_inflate.inflateGetHeader(this.strm,this.header)};Inflate.prototype.push=function(data,mode){var status,_mode,next_out_utf8,tail,utf8str,strm=this.strm,chunkSize=this.options.chunkSize,allowBufError=!1;if(this.ended)return!1;_mode=mode===~~mode?mode:mode===!0?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof data?strm.input=strings.binstring2buf(data):"[object ArrayBuffer]"===toString.call(data)?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new utils.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH),status===c.Z_BUF_ERROR&&allowBufError===!0&&(status=c.Z_OK,allowBufError=!1),status!==c.Z_STREAM_END&&status!==c.Z_OK)return this.onEnd(status),this.ended=!0,!1;strm.next_out&&(0===strm.avail_out||status===c.Z_STREAM_END||0===strm.avail_in&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH))&&("string"===this.options.to?(next_out_utf8=strings.utf8border(strm.output,strm.next_out),tail=strm.next_out-next_out_utf8,utf8str=strings.buf2string(strm.output,next_out_utf8),strm.next_out=tail,strm.avail_out=chunkSize-tail,tail&&utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0),this.onData(utf8str)):this.onData(utils.shrinkBuf(strm.output,strm.next_out))),0===strm.avail_in&&0===strm.avail_out&&(allowBufError=!0)}while((strm.avail_in>0||0===strm.avail_out)&&status!==c.Z_STREAM_END);return status===c.Z_STREAM_END&&(_mode=c.Z_FINISH),_mode===c.Z_FINISH?(status=zlib_inflate.inflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===c.Z_OK):_mode===c.Z_SYNC_FLUSH?(this.onEnd(c.Z_OK),strm.avail_out=0,!0):!0},Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Inflate.prototype.onEnd=function(status){status===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg},exports.Inflate=Inflate,exports.inflate=inflate,exports.inflateRaw=inflateRaw,exports.ungzip=inflate},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),HRMParser.prototype.extract_labels=function(ilines){"use strict";var out={};out.olines=[],out.labels={},out.labels.comment={},out.labels.label={};for(var i=0;i<ilines.length;i++){var match,thisline=ilines[i];if(match=this.re_define.exec(thisline)){for(var body="",more=1;more;){i++;var line=ilines[i];line=line.replace(/^\s+/,""),line=line.replace(/\s+$/,""),/;$/.test(line)&&(line=line.replace(/;$/,""),more=0),body+=line,i>=ilines.length&&(more=0)}var mytype=match[1].toLowerCase();out.labels[mytype][match[2]]=body}else out.olines.push(thisline)}return out},HRMParser.prototype.re_define=/^DEFINE\s+(\S+)\s+(\S+)/i,HRMViewer.prototype.simple_svg=function(width,height,view_min_x,view_min_y,view_width,view_height){"use strict";var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("version","1.1"),svg.setAttribute("baseProfile","full"),"undefined"==typeof view_min_x?(svg.setAttribute("width",width),svg.setAttribute("height",height)):svg.setAttribute("viewBox",view_min_x+" "+view_min_y+" "+view_width+" "+view_height),svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svg=svg,this.new_el=function(name){return document.createElementNS(this.svg.namespaceURI,name)};var marker_size=2.75,path=this.new_el("path");path.setAttribute("d","M0,0 L0,"+marker_size+" L"+marker_size+","+marker_size/2+" Z"),path.setAttribute("stroke-width",0),path.setAttribute("class","jumppatharrow");var marker=this.new_el("marker");marker.setAttribute("id","markerArrow"),marker.setAttribute("markerWidth",marker_size),marker.setAttribute("markerHeight",marker_size),marker.setAttribute("refX","0"),marker.setAttribute("refY",marker_size/2),marker.setAttribute("orient","auto"),marker.setAttribute("markerUnits","strokeWidth"),marker.appendChild(path);var defs=this.new_el("defs");defs.appendChild(marker),this.svg.appendChild(defs),this.rect=function(x,y,width,height,color){var e=this.new_el("rect");e.setAttribute("x",x),e.setAttribute("y",y),e.setAttribute("width",width),e.setAttribute("height",height),e.setAttribute("fill",color),this.svg.appendChild(e)},this.circle=function(x,y,radius,newclass){var e=this.new_el("circle");e.setAttribute("cx",x),e.setAttribute("cy",y),e.setAttribute("r",radius),e.setAttribute("class",newclass),this.svg.appendChild(e)},this.polyline=function(points,width,newclass){for(var e=this.new_el("polyline"),pts="",i=0;i<points.length;i++)pts+=points[i][0]+" "+points[i][1]+" ";e.setAttribute("points",pts),e.setAttribute("class",newclass),e.setAttribute("fill","transparent"),e.setAttribute("stroke-width",width),this.svg.appendChild(e)},this.path=function(command,thisclass){var e=this.new_el("path");e.setAttribute("d",command),e.setAttribute("class",thisclass),e.setAttribute("style","marker-end: url(#markerArrow)"),this.svg.appendChild(e)}},HRMViewer.prototype.new_hrm_label_svg=function(enclabel){"use strict";for(var label=new HRMLabel(enclabel),new_svg=new this.simple_svg(label.width,label.height,label.extents.min_x,label.extents.min_y,label.extents.width,label.extents.height),i=0;i<label.strokes.length;i++){var points=label.strokes[i];0==points.length||(1==points.length?new_svg.circle(points[0][0],points[0][1],label.brush_diameter/2,"stroke"):new_svg.polyline(points,label.brush_diameter,"stroke"))}return new_svg.svg},HRMViewer.prototype.create_jump_diagram=function(width,height,offset_left,offset_top,srcs,dsts){"use strict";for(var new_svg=new this.simple_svg(width,height),max_start_x=0,gaps=[],i=0;i<srcs.length;i++){var src=srcs[i].el,start_x=src.offset().left+src.outerWidth()-offset_left;start_x>max_start_x&&(max_start_x=start_x);var sy=src.offset().top,label=srcs[i].dst;if(label in dsts){var dst=dsts[label],dy=dst.offset().top;gaps.push(Math.abs(dy-sy))}}gaps.sort(function(a,b){return a-b});for(var first_transit=max_start_x+0,transit_width=10,last_transit=width-transit_width,num_transits=Math.floor((last_transit-first_transit)/transit_width+1),transit_breaks=[],gaps_per_transit=gaps.length/num_transits,i=0;num_transits>i;i++)transit_breaks.push(gaps[Math.floor(gaps_per_transit*i)]);for(var i=0;i<srcs.length;i++){var label=srcs[i].dst,src=srcs[i].el;if(label in dsts){var dst=dsts[label],startx=src.offset().left-offset_left+src.outerWidth(),starty=src.offset().top-offset_top+src.outerHeight()/2,endx=dst.offset().left-offset_left+dst.outerWidth()+25,endy=dst.offset().top-offset_top+dst.outerHeight()/2,gap_y=Math.abs(endy-starty),transit=0;for(transit=0;transit<transit_breaks.length&&!(gap_y<transit_breaks[transit]);transit++);var mid_x=first_transit+transit*transit_width,mid_y=(starty+endy)/2,bcurve_y=(starty-endy)/2,path_cmd=["M",startx,starty,"C",startx+20,starty,mid_x,mid_y+bcurve_y,mid_x,mid_y,"C",mid_x,mid_y-bcurve_y,endx+20,endy,endx,endy].join(" ");new_svg.path(path_cmd,"jumppath")}else console.log("jump label",label,"lacks a matching destination")}return new_svg.svg},HRMViewer.prototype.append_code_table=function(id,data){"use strict";this.root_div=$("#"+id),this.root_div.empty();var parser=new HRMParser(data);this.root=$(document.createElement("table"));var rightarrow="➡︎";this.dsts={},this.srcs=[],this.line_to_row={};var num_len=2,pad="00000",code_lines=parser.code.length;code_lines.length>9999?num_len=5:code_lines.length>999?num_len=4:code_lines.length>99&&(num_len=3);for(var i=0;i<parser.code.length;i++){var linecode=parser.code[i],cmd=linecode.cmd,arg=linecode.arg;if("blank"!=cmd){var jmpdst,newclass=cmd,text=cmd;"bumpup"==cmd?text="bump +":"bumpdn"==cmd?text="bump −":"inbox"==cmd?text=rightarrow+" inbox":"outbox"==cmd?text="outbox "+rightarrow:"asm_comment"==cmd?(text=arg,arg=void 0):"jumpdst"==cmd?(text=arg,arg=void 0):("jump"==cmd||"jumpn"==cmd||"jumpz"==cmd)&&(jmpdst=arg,arg=void 0);var comment_id;"comment"==cmd&&(comment_id=arg,comment_id in parser.comments&&(text="",arg=void 0));var e_cmd=$(document.createElement("span"));if("jumpn"==cmd||"jumpz"==cmd){e_cmd.append(document.createTextNode("jump"));var overunder=$(document.createElement("div"));overunder.addClass("jumptype"),overunder.append(document.createTextNode("if")),overunder.append(document.createElement("br")),"jumpn"==text?overunder.append(document.createTextNode("negative")):"jumpz"==text?overunder.append(document.createTextNode("zero")):overunder.append(document.createTextNode("unknown")),e_cmd.append(overunder)}else e_cmd.text(text);if(e_cmd.addClass(newclass),e_cmd.addClass("cmd"),"jumpdst"==cmd&&(this.dsts[text]=e_cmd),"comment"==cmd&&comment_id in parser.comments){var svg=this.new_hrm_label_svg(parser.comments[comment_id]);svg=$(svg),e_cmd.append(svg)}var re_memory_addr=/^\d+$/,e_arg=0;if(void 0!==arg){e_arg=$(document.createElement("span")),e_arg.addClass(newclass),e_arg.addClass("arg");var tmp;if(re_memory_addr.test(arg))if(arg in parser.labels){var svg=this.new_hrm_label_svg(parser.labels[arg]);svg=$(svg),e_arg.append(svg)}else e_arg.text(arg);else if(tmp=/\[(\d+)\]/.exec(arg)){var num=tmp[1];if(num in parser.labels){e_arg.append(document.createTextNode("[ "));var svg=this.new_hrm_label_svg(parser.labels[num]);svg=$(svg),e_arg.append(svg),e_arg.append(document.createTextNode(" ]"))}else e_arg.text(arg)}else e_arg.text(arg)}("jump"==newclass||"jumpn"==newclass||"jumpz"==newclass)&&this.srcs.push({dst:jmpdst,el:e_cmd});var new_td_num=$(document.createElement("td"));if(linecode.line_num){var linenum=(pad+linecode.line_num).slice(-num_len);new_td_num.text(linenum)}new_td_num.addClass("linenum");var new_td_code=$(document.createElement("td"));new_td_code.append(e_cmd),e_arg&&(new_td_code.append($(document.createTextNode(" "))),new_td_code.append(e_arg));var new_row=$(document.createElement("tr"));new_row.append(new_td_num),new_row.append(new_td_code),this.root.append(new_row),this.line_to_row[linecode.src_line_num]=new_row}}this.root_div.append(this.root);var that=this;setTimeout(function(){that.updateJumpArrows()},10)},HRMViewer.prototype.updateJumpArrows=function(){"use strict";this.svg&&this.svg.remove();var table_width=this.root.outerWidth(),table_height=this.root.outerHeight();this.svg=this.create_jump_diagram(table_width+50,table_height,this.root_div.offset().left,this.root_div.offset().top,this.srcs,this.dsts),this.root_div.append(this.svg)},HRMViewer.prototype.setActiveLine=function(line_num){this.active_row&&this.active_row.removeClass("active"),void 0!==line_num&&(this.active_row=this.line_to_row[line_num],this.active_row&&this.active_row.addClass("active"))},HRMViewer.prototype.download_and_append_code_table=function(id,url){"use strict";function code_arrived(data){t.append_code_table(id,data)}function failure(xhr,tstatus,err){$("#"+id).empty(),$("#"+id).text("Error loading "+url+". "+tstatus+" "+err)}var t=this;$.ajax({url:url,success:code_arrived,error:failure,dataType:"text"})};var hrm_viewer=HRMViewer;!function($){function setMinHeightAndMinWidth(){var $splitPane=$(this),$firstComponent=$splitPane.children(".split-pane-component:first"),$divider=$splitPane.children(".split-pane-divider"),$lastComponent=$splitPane.children(".split-pane-component:last");$splitPane.is(".fixed-top, .fixed-bottom, .horizontal-percent")?$splitPane.css("min-height",minHeight($firstComponent)+minHeight($lastComponent)+$divider.height()+"px"):$splitPane.css("min-width",minWidth($firstComponent)+minWidth($lastComponent)+$divider.width()+"px")}function mousedownHandler(event){event.preventDefault();var $resizeShim=$(this).siblings(".split-pane-resize-shim").show(),mousemove=createMousemove($(this).parent(),event.pageX,event.pageY);$(document).mousemove(mousemove),$(document).one("mouseup",function(event){$(document).unbind("mousemove",mousemove),$resizeShim.hide()})}function parentresizeHandler(){var $splitPane=$(this),$firstComponent=$splitPane.children(".split-pane-component:first"),$divider=$splitPane.children(".split-pane-divider"),$lastComponent=$splitPane.children(".split-pane-component:last");if($splitPane.is(".fixed-top")){var maxfirstComponentHeight=$splitPane.height()-minHeight($lastComponent)-$divider.height();$firstComponent.height()>maxfirstComponentHeight?setTop($splitPane,$firstComponent,$divider,$lastComponent,maxfirstComponentHeight+"px"):$splitPane.resize()}else if($splitPane.is(".fixed-bottom")){var maxLastComponentHeight=$splitPane.height()-minHeight($firstComponent)-$divider.height();$lastComponent.height()>maxLastComponentHeight?setBottom($splitPane,$firstComponent,$divider,$lastComponent,maxLastComponentHeight+"px"):$splitPane.resize()}else if($splitPane.is(".horizontal-percent")){var maxLastComponentHeight=$splitPane.height()-minHeight($firstComponent)-$divider.height();if($lastComponent.height()>maxLastComponentHeight)setBottom($splitPane,$firstComponent,$divider,$lastComponent,maxLastComponentHeight/$splitPane.height()*100+"%");else{var lastComponentMinHeight=minHeight($lastComponent);$splitPane.height()-$firstComponent.height()-$divider.height()<lastComponentMinHeight?setBottom($splitPane,$firstComponent,$divider,$lastComponent,lastComponentMinHeight/$splitPane.height()*100+"%"):$splitPane.resize()}}else if($splitPane.is(".fixed-left")){var maxFirstComponentWidth=$splitPane.width()-minWidth($lastComponent)-$divider.width();$firstComponent.width()>maxFirstComponentWidth?setLeft($splitPane,$firstComponent,$divider,$lastComponent,maxFirstComponentWidth+"px"):$splitPane.resize()}else if($splitPane.is(".fixed-right")){var maxLastComponentWidth=$splitPane.width()-minWidth($firstComponent)-$divider.width();$lastComponent.width()>maxLastComponentWidth?setRight($splitPane,$firstComponent,$divider,$lastComponent,maxLastComponentWidth+"px"):$splitPane.resize()}else if($splitPane.is(".vertical-percent")){var maxLastComponentWidth=$splitPane.width()-minWidth($firstComponent)-$divider.width();if($lastComponent.width()>maxLastComponentWidth)setRight($splitPane,$firstComponent,$divider,$lastComponent,maxLastComponentWidth/$splitPane.width()*100+"%");else{var lastComponentMinWidth=minWidth($lastComponent);$splitPane.width()-$firstComponent.width()-$divider.width()<lastComponentMinWidth?setRight($splitPane,$firstComponent,$divider,$lastComponent,lastComponentMinWidth/$splitPane.width()*100+"%"):$splitPane.resize()}}}function createMousemove($splitPane,pageX,pageY){var $firstComponent=$splitPane.children(".split-pane-component:first"),$divider=$splitPane.children(".split-pane-divider"),$lastComponent=$splitPane.children(".split-pane-component:last");if($splitPane.is(".fixed-top")){var firstComponentMinHeight=minHeight($firstComponent),maxFirstComponentHeight=$splitPane.height()-minHeight($lastComponent)-$divider.height(),topOffset=$divider.position().top-pageY;return function(event){event.preventDefault();var top=Math.min(Math.max(firstComponentMinHeight,topOffset+event.pageY),maxFirstComponentHeight);setTop($splitPane,$firstComponent,$divider,$lastComponent,top+"px")}}if($splitPane.is(".fixed-bottom")){var lastComponentMinHeight=minHeight($lastComponent),maxLastComponentHeight=$splitPane.height()-minHeight($firstComponent)-$divider.height(),bottomOffset=$lastComponent.height()+pageY;return function(event){event.preventDefault();var bottom=Math.min(Math.max(lastComponentMinHeight,bottomOffset-event.pageY),maxLastComponentHeight);setBottom($splitPane,$firstComponent,$divider,$lastComponent,bottom+"px")}}if($splitPane.is(".horizontal-percent")){var splitPaneHeight=$splitPane.height(),lastComponentMinHeight=minHeight($lastComponent),maxLastComponentHeight=splitPaneHeight-minHeight($firstComponent)-$divider.height(),bottomOffset=$lastComponent.height()+pageY;return function(event){event.preventDefault();var bottom=Math.min(Math.max(lastComponentMinHeight,bottomOffset-event.pageY),maxLastComponentHeight);setBottom($splitPane,$firstComponent,$divider,$lastComponent,bottom/splitPaneHeight*100+"%")}}if($splitPane.is(".fixed-left")){var firstComponentMinWidth=minWidth($firstComponent),maxFirstComponentWidth=$splitPane.width()-minWidth($lastComponent)-$divider.width(),leftOffset=$divider.position().left-pageX;return function(event){event.preventDefault();var left=Math.min(Math.max(firstComponentMinWidth,leftOffset+event.pageX),maxFirstComponentWidth);setLeft($splitPane,$firstComponent,$divider,$lastComponent,left+"px")}}if($splitPane.is(".fixed-right")){var lastComponentMinWidth=minWidth($lastComponent),maxLastComponentWidth=$splitPane.width()-minWidth($firstComponent)-$divider.width(),rightOffset=$lastComponent.width()+pageX;return function(event){event.preventDefault();var right=Math.min(Math.max(lastComponentMinWidth,rightOffset-event.pageX),maxLastComponentWidth);setRight($splitPane,$firstComponent,$divider,$lastComponent,right+"px")}}if($splitPane.is(".vertical-percent")){var splitPaneWidth=$splitPane.width(),lastComponentMinWidth=minWidth($lastComponent),maxLastComponentWidth=splitPaneWidth-minWidth($firstComponent)-$divider.width(),rightOffset=$lastComponent.width()+pageX;return function(event){event.preventDefault();var right=Math.min(Math.max(lastComponentMinWidth,rightOffset-event.pageX),maxLastComponentWidth);setRight($splitPane,$firstComponent,$divider,$lastComponent,right/splitPaneWidth*100+"%")}}}function minHeight($element){return parseInt($element.css("min-height"))||0}function minWidth($element){return parseInt($element.css("min-width"))||0}function setTop($splitPane,$firstComponent,$divider,$lastComponent,top){$firstComponent.css("height",top),$divider.css("top",top),$lastComponent.css("top",top),$splitPane.resize()}function setBottom($splitPane,$firstComponent,$divider,$lastComponent,bottom){$firstComponent.css("bottom",bottom),$divider.css("bottom",bottom),$lastComponent.css("height",bottom),$splitPane.resize()}function setLeft($splitPane,$firstComponent,$divider,$lastComponent,left){$firstComponent.css("width",left),$divider.css("left",left),$lastComponent.css("left",left),$splitPane.resize()}function setRight($splitPane,$firstComponent,$divider,$lastComponent,right){$firstComponent.css("right",right),$divider.css("right",right),$lastComponent.css("width",right),$splitPane.resize()}$.fn.splitPane=function(){var $splitPanes=this;$splitPanes.each(setMinHeightAndMinWidth),$splitPanes.append('<div class="split-pane-resize-shim">'),$splitPanes.children(".split-pane-divider").bind("mousedown",mousedownHandler),setTimeout(function(){$splitPanes.bind("_splitpaneparentresize",parentresizeHandler),$(window).trigger("resize")},100)};var SPLITPANERESIZE_HANDLER="_splitpaneparentresizeHandler";jQuery.event.special._splitpaneparentresize={setup:function(data,namespaces){var element=this,parent=$(this).parent().closest(".split-pane")[0]||window;$(this).data(SPLITPANERESIZE_HANDLER,function(event){var target=event.target===document?window:event.target;target===parent?(event.type="_splitpaneparentresize",jQuery.event.handle.apply(element,arguments)):event.stopPropagation()}),$(parent).bind("resize",$(this).data(SPLITPANERESIZE_HANDLER))},teardown:function(namespaces){var parent=$(this).parent().closest(".split-pane")[0]||window;$(parent).unbind("resize",$(this).data(SPLITPANERESIZE_HANDLER)),$(this).removeData(SPLITPANERESIZE_HANDLER)}}}(jQuery),CodeMirror.defineSimpleMode("hrm",{start:[{regex:/(?:INBOX|OUTBOX)\b/,token:"keyword"},{regex:/(COPYFROM|COPYTO|ADD|SUB|BUMPUP|BUMPDN|COMMENT|DEFINE\s+(?:COMMENT|LABEL))\s+([0-9]+)/,token:["keyword","number"]},{regex:/(COPYFROM|COPYTO|ADD|SUB|BUMPUP|BUMPDN|COMMENT|DEFINE\s+(?:COMMENT|LABEL))\s+\[\s*([0-9]+)\s*\]/,token:["keyword","number"]},{regex:/--.*/,token:"comment"},{regex:/(JUMP|JUMPZ|JUMPN)\s+([a-zA-Z][a-zA-Z0-9]*)/,token:["keyword",null,"label-dest"]},{regex:/([a-zA-Z][a-zA-Z0-9]*):/,token:["label"]}],meta:{dontIndentStates:["comment"],lineComment:"--"}}),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){window.HrmProgram=require("./hrm-engine.js"),window.HrmProgramState=require("./hrmProgramState.js")},{"./hrm-engine.js":2,"./hrmProgramState.js":4}],2:[function(require,module,exports){"use strict";function checkValue(value){return"number"==typeof value?value>=MIN_VALUE&&MAX_VALUE>=value:!0}function findIndex(list,predicate){for(var length=list.length,i=0;length>i;i++)if(predicate(list[i],i,list))return i;return-1}function Parse(source,options){options=options||{};var program=hrm.parser.parse(source);return new HrmProgram(program,options)}var hrm=require("hrm-grammar"),HrmProgramError=require("./hrmProgramError.js"),HrmProgramState=require("./hrmProgramState.js"),MAX_STATEMENTS=255,MAX_ITERATIONS=5e3,MIN_VALUE=-999,MAX_VALUE=999,HrmProgram=function(program,options){if(!(this instanceof HrmProgram))return new HrmProgram(options);if(options=options||{},this._program=program||{statements:[]},this._program.statements.length>MAX_STATEMENTS)throw new Error("Program exceeded maximum length ("+MAX_STATEMENTS+"): "+this._program.statements.length);this.maxIterations=options.maxIterations||MAX_ITERATIONS,this.debug=options.debug,this._breakpoints=[],this._instructionCount=0,this._labels={};for(var ix=0;ix<this._program.statements.length;++ix){var stmt=this._program.statements[ix];"label"===stmt.type?this._labels[stmt.label]=ix:"define"!==stmt.type&&"comment"!==stmt.type&&this._instructionCount++}};HrmProgram.prototype.setBreakpoints=function(breakpoints){var self=this;this._breakpoints=breakpoints.map(function(bp){return findIndex(self._program.statements,function(stmt){return stmt._location.start.line===bp})}).filter(function(bp){return bp>=0}),console.dir(this._breakpoints)},HrmProgram.prototype.createState=function(options){options=options||{};var state=new HrmProgramState(options);return state},HrmProgram.prototype.step=function(state){if(state.ip>=0&&state.ip<this._program.statements.length&&state.iterations++<MAX_ITERATIONS){var statements=this._program.statements;if(!state.isAtBreakpoint&&this._breakpoints.indexOf(state.ip)>=0)return state.isAtBreakpoint=!0,state.labelsHit++,"break";state.isAtBreakpoint&&(state.isAtBreakpoint=!1);var stmt=statements[state.ip++];switch(stmt.type){case"define":state.labelsHit++;break;case"comment":state.labelsHit++;break;case"label":state.labelsHit++;break;case"inbox":state.hand=this.do_inbox(state);break;case"outbox":state.hand=this.do_outbox(state);break;case"copyfrom":state.hand=this.do_copyfrom(state,stmt.arg);break;case"copyto":state.hand=this.do_copyto(state,stmt.arg);break;case"add":case"sub":case"bumpup":case"bumpdn":if(state.hand=this.do_math(state,stmt.type,stmt.arg),!checkValue(state.hand))throw new HrmProgramError("Value out of bounds",state);break;case"jump":state.ip=this.do_jump(state,stmt.label);break;case"jumpz":state.ip=this.do_jumpz(state,stmt.label);break;case"jumpn":state.ip=this.do_jumpneg(state,stmt.label);break;default:throw new HrmProgramError("Unknown instruction: "+stmt.type,state)}return!0}return!1},HrmProgram.prototype.resume=function(state){for(;state.ip>=0&&state.ip<this._program.statements.length&&state.iterations<this.maxIterations;)if("break"===this.step(state))return"break"},HrmProgram.prototype.execute=function(options){for(var state=new HrmProgramState(options);state.ip>=0&&state.ip<this._program.statements.length&&state.iterations<this.maxIterations;)if("break"===this.step(state))return"break"},HrmProgram.prototype.do_inbox=function(state){if(state.inbox.length){var value=state.inbox.shift();if(!checkValue(value))throw new HrmProgramError("Value out of bounds",state);return value}return state.ip=-1,void state.labelsHit++},HrmProgram.prototype.do_outbox=function(state){if(void 0!==state.hand)return void state.outbox.push(state.hand);throw new HrmProgramError("Nothing in your hand to outbox!",state)},HrmProgram.prototype.do_copyfrom=function(state,variable){return state.load(variable)},HrmProgram.prototype.do_copyto=function(state,variable){if(void 0!==state.hand)return state.store(variable,state.hand);throw new HrmProgramError("Cannot copy to variable with an empty hand",state)},HrmProgram.prototype.do_jump=function(state,label){if(!this._labels.hasOwnProperty(label))throw new HrmProgramError("Unknown label: "+label,state);return this._labels[label]},HrmProgram.prototype.do_jumpz=function(state,label){if(void 0===state.hand)throw new HrmProgramError("Cannot jumpz with an empty hand",state);if(!this._labels.hasOwnProperty(label))throw new HrmProgramError("Unknown label: "+label,state);return 0===state.hand?this._labels[label]:state.ip},HrmProgram.prototype.do_jumpneg=function(state,label){if(void 0===state.hand)throw new HrmProgramError("Cannot jumpneg with an empty hand",state);if(!this._labels.hasOwnProperty(label))throw new HrmProgramError("Unknown label: "+label,state);return state.hand<0?this._labels[label]:state.ip},HrmProgram.prototype.do_math=function(state,op,variable){if("bumpup"!==op&&"bumpdn"!==op&&void 0===state.hand)throw new HrmProgramError("Cannot "+op+" with an empty hand.",state);if(!state.isDefined(variable.name))throw new HrmProgramError("Cannot "+op+" with an undefined variable: "+variable.name,state);var value=state.load(variable);switch(op){case"add":if("number"!=typeof state.hand||"number"!=typeof value)throw new HrmProgramError("Cannot add non-numeric arguments",state);return state.hand+value;case"sub":if("number"==typeof state.hand){if("number"!=typeof value)throw new HrmProgramError("Cannot subtract arguments of different types",state);return state.hand-value}if("number"==typeof value)throw new HrmProgramError("Cannot subtract arguments of different types",state);return state.hand.charCodeAt(0)-value.charCodeAt(0);case"bumpup":if("number"!=typeof value)throw new HrmProgramError("Cannot bumpup non-numeric argument",state);if(!checkValue(++value))throw new HrmProgramError("Value out of bounds",state);return state.store(variable,value);case"bumpdn":if("number"!=typeof value)throw new HrmProgramError("Cannot bumpdn non-numeric argument",state);if(!checkValue(--value))throw new HrmProgramError("Value out of bounds",state);return state.store(variable,value);default:throw new HrmProgramError("Unsupported math operation: "+op,state)}},module.exports={parse:Parse}},{"./hrmProgramError.js":3,"./hrmProgramState.js":4,"hrm-grammar":10}],3:[function(require,module,exports){"use strict";function HrmProgramError(message,internalState){this.message=message,this.internalState=internalState,this.name="HrmProgramError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,HrmProgramError),Error.call(this)}var util=require("util");util.inherits(HrmProgramError,Error),module.exports=HrmProgramError},{util:8}],4:[function(require,module,exports){"use strict";var HrmProgramError=(require("util"),require("./hrmProgramError.js")),HrmProgramState=function(options){return this instanceof HrmProgramState?(options=options||{},this.inbox=options.inbox||[],this.variables=options.variables||{},this.outbox=[],this.hand=void 0,this.ip=0,this.isAtBreakpoint=!1,this.iterations=0,void(this.labelsHit=0)):new HrmProgramState(options)};module.exports=HrmProgramState,HrmProgramState.prototype.isDefined=function(variable){return this.variables.hasOwnProperty(variable)&&void 0!==this.variables[variable]},HrmProgramState.prototype.load=function(variable){if(!this.isDefined(variable.name))throw new HrmProgramError("Undefined variable: "+variable.name,this);switch(variable.type){case"Identifier":return this.variables[variable.name];case"IndirectIdentifier":var address=this.variables[variable.name];if("number"!=typeof address||0>address)throw new HrmProgramError("Invalid address: "+address);if(this.isDefined(address))return this.variables[address];throw new HrmProgramError("Undefined variable: "+address,this);default:throw new HrmProgramError("Unsupported addressing mode: "+variable.type,this)}},HrmProgramState.prototype.store=function(variable,value){if(void 0===value)throw new HrmProgramError("Cannot store undefined value");switch(variable.type){case"Identifier":return this.variables[variable.name]=value,value;case"IndirectIdentifier":if(this.isDefined(variable.name)){var address=this.variables[variable.name];if("number"!=typeof address||0>address)throw new HrmProgramError("Invalid address: "+address);return this.variables[address]=value,value}throw new HrmProgramError("Undefined variable: "+variable.name,this);default:throw new HrmProgramError("Unsupported addressing mode: "+variable.type,this)}}},{"./hrmProgramError.js":3,util:8}],5:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],6:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,
len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],7:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],8:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:6,inherits:5}],9:[function(require,module,exports){module.exports=function(){"use strict";function peg$subclass(child,parent){function ctor(){this.constructor=child}ctor.prototype=parent.prototype,child.prototype=new ctor}function peg$SyntaxError(message,expected,found,location){this.message=message,this.expected=expected,this.found=found,this.location=location,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(input){function location(){return peg$computeLocation(peg$savedPos,peg$currPos)}function error(message){throw peg$buildException(message,null,input.substring(peg$savedPos,peg$currPos),peg$computeLocation(peg$savedPos,peg$currPos))}function peg$computePosDetails(pos){var p,ch,details=peg$posDetailsCache[pos];if(details)return details;for(p=pos-1;!peg$posDetailsCache[p];)p--;for(details=peg$posDetailsCache[p],details={line:details.line,column:details.column,seenCR:details.seenCR};pos>p;)ch=input.charAt(p),"\n"===ch?(details.seenCR||details.line++,details.column=1,details.seenCR=!1):"\r"===ch||"\u2028"===ch||"\u2029"===ch?(details.line++,details.column=1,details.seenCR=!0):(details.column++,details.seenCR=!1),p++;return peg$posDetailsCache[pos]=details,details}function peg$computeLocation(startPos,endPos){var startPosDetails=peg$computePosDetails(startPos),endPosDetails=peg$computePosDetails(endPos);return{start:{offset:startPos,line:startPosDetails.line,column:startPosDetails.column},end:{offset:endPos,line:endPosDetails.line,column:endPosDetails.column}}}function peg$fail(expected){peg$maxFailPos>peg$currPos||(peg$currPos>peg$maxFailPos&&(peg$maxFailPos=peg$currPos,peg$maxFailExpected=[]),peg$maxFailExpected.push(expected))}function peg$buildException(message,expected,found,location){function cleanupExpected(expected){var i=1;for(expected.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});i<expected.length;)expected[i-1]===expected[i]?expected.splice(i,1):i++}function buildMessage(expected,found){function stringEscape(s){function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}return s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(ch){return"\\x"+hex(ch)}).replace(/[\u0100-\u0FFF]/g,function(ch){return"\\u0"+hex(ch)}).replace(/[\u1000-\uFFFF]/g,function(ch){return"\\u"+hex(ch)})}var expectedDesc,foundDesc,i,expectedDescs=new Array(expected.length);for(i=0;i<expected.length;i++)expectedDescs[i]=expected[i].description;return expectedDesc=expected.length>1?expectedDescs.slice(0,-1).join(", ")+" or "+expectedDescs[expected.length-1]:expectedDescs[0],foundDesc=found?'"'+stringEscape(found)+'"':"end of input","Expected "+expectedDesc+" but "+foundDesc+" found."}return null!==expected&&cleanupExpected(expected),new peg$SyntaxError(null!==message?message:buildMessage(expected,found),expected,found,location)}function peg$parseStart(){var s0,s1;return s0=peg$currPos,s1=peg$parseProgram(),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c0(s1)),s0=s1}function peg$parseProgram(){var s0,s1,s2,s3;return s0=peg$currPos,s1=peg$parse__(),s1!==peg$FAILED?(s2=peg$parseLines(),s2===peg$FAILED&&(s2=null),s2!==peg$FAILED?(s3=peg$parse__(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c1(s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),s0}function peg$parseLines(){var s0,s1,s2,s3,s4,s5,s6;if(s0=peg$currPos,s1=peg$parse__(),s1!==peg$FAILED)if(s2=peg$parseLine(),s2!==peg$FAILED){for(s3=[],s4=peg$currPos,s5=peg$parse__(),s5!==peg$FAILED?(s6=peg$parseLine(),s6!==peg$FAILED?(s5=[s5,s6],s4=s5):(peg$currPos=s4,s4=peg$FAILED)):(peg$currPos=s4,s4=peg$FAILED);s4!==peg$FAILED;)s3.push(s4),s4=peg$currPos,s5=peg$parse__(),s5!==peg$FAILED?(s6=peg$parseLine(),s6!==peg$FAILED?(s5=[s5,s6],s4=s5):(peg$currPos=s4,s4=peg$FAILED)):(peg$currPos=s4,s4=peg$FAILED);s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c2(s2,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseLine(){var s0,s1,s2,s3;return s0=peg$currPos,s1=peg$parse_(),s1!==peg$FAILED?(s2=peg$parseStatement(),s2!==peg$FAILED?(s3=peg$parse_(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c3(s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),s0}function peg$parseStatement(){var s0,s1,s2,s3,s4;return s0=peg$parseUnterminatedStatement(),s0===peg$FAILED&&(s0=peg$currPos,s1=peg$parseTerminatedStatement(),s1!==peg$FAILED?(s2=peg$parse_(),s2!==peg$FAILED?(s3=peg$parseComment(),s3===peg$FAILED&&(s3=null),s3!==peg$FAILED?(s4=peg$parseLineTerminatorSequence(),s4===peg$FAILED&&(s4=peg$parseEOF()),s4!==peg$FAILED?(peg$savedPos=s0,s1=peg$c4(s1),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)),s0}function peg$parseUnterminatedStatement(){var s0;return s0=peg$parseLabelStatement(),s0===peg$FAILED&&(s0=peg$parseNoArgStatement()),s0}function peg$parseTerminatedStatement(){var s0;return s0=peg$parseLabeledJumpStatement(),s0===peg$FAILED&&(s0=peg$parseOneArgStatement(),s0===peg$FAILED&&(s0=peg$parseDefineStatement(),s0===peg$FAILED&&(s0=peg$parseCommentStatement()))),s0}function peg$parseNoArgStatement(){var s0;return s0=peg$parseInboxStatement(),s0===peg$FAILED&&(s0=peg$parseOutboxStatement()),s0}function peg$parseOneArgStatement(){var s0;return s0=peg$parseAddStatement(),s0===peg$FAILED&&(s0=peg$parseSubStatement(),s0===peg$FAILED&&(s0=peg$parseBumpupStatement(),s0===peg$FAILED&&(s0=peg$parseBumpdnStatement(),s0===peg$FAILED&&(s0=peg$parseCopytoStatement(),s0===peg$FAILED&&(s0=peg$parseCopyfromStatement()))))),s0}function peg$parseLabeledJumpStatement(){var s0;return s0=peg$parseJumpzStatement(),s0===peg$FAILED&&(s0=peg$parseJumpnStatement(),s0===peg$FAILED&&(s0=peg$parseJumpStatement())),s0}function peg$parseDefineStatement(){var s0;return s0=peg$parseDefineLabelStatement(),s0===peg$FAILED&&(s0=peg$parseDefineCommentStatement()),s0}function peg$parseLabelStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$currPos,peg$silentFails++,s2=peg$parseReservedWord(),peg$silentFails--,s2===peg$FAILED?s1=void 0:(peg$currPos=s1,s1=peg$FAILED),s1!==peg$FAILED?(s2=peg$parseLabel(),s2!==peg$FAILED?(58===input.charCodeAt(peg$currPos)?(s3=peg$c6,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c7)),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c8(s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c5)),s0}function peg$parseArgument(){var s0;return s0=peg$parseDirectArgument(),s0===peg$FAILED&&(s0=peg$parseIndirectArgument()),s0}function peg$parseDirectArgument(){var s0,s1,s2;if(peg$silentFails++,s0=peg$currPos,s1=[],s2=peg$parseDigit(),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),s2=peg$parseDigit();else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c10(s1)),s0=s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c9)),s0}function peg$parseIndirectArgument(){var s0,s1,s2,s3,s4,s5;if(peg$silentFails++,s0=peg$currPos,91===input.charCodeAt(peg$currPos)?(s1=peg$c12,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c13)),s1!==peg$FAILED)if(s2=peg$parse__(),s2!==peg$FAILED){if(s3=[],s4=peg$parseDigit(),s4!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),s4=peg$parseDigit();else s3=peg$FAILED;s3!==peg$FAILED?(s4=peg$parse__(),s4!==peg$FAILED?(93===input.charCodeAt(peg$currPos)?(s5=peg$c14,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c15)),s5!==peg$FAILED?(peg$savedPos=s0,s1=peg$c16(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s0}function peg$parseLabel(){var s0,s1,s2,s3;if(peg$silentFails++,s0=peg$currPos,s1=peg$parseLetter(),s1!==peg$FAILED){for(s2=[],s3=peg$parseLetter(),s3===peg$FAILED&&(s3=peg$parseDigit());s3!==peg$FAILED;)s2.push(s3),s3=peg$parseLetter(),s3===peg$FAILED&&(s3=peg$parseDigit());s2!==peg$FAILED?(peg$savedPos=s0,s1=peg$c18(s1,s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c17)),s0}function peg$parseInboxStatement(){var s0,s1;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkInbox(),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c20()),s0=s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c19)),s0}function peg$parseOutboxStatement(){var s0,s1;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkOutbox(),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c22()),s0=s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c21)),s0}function peg$parseAddStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkAdd(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c24(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s0}function peg$parseSubStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkSub(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c26(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c25)),s0}function peg$parseBumpupStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkBumpup(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c28(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c27)),s0}function peg$parseBumpdnStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkBumpdn(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c30(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c29)),s0}function peg$parseCopytoStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkCopyto(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c32(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s0}function peg$parseCopyfromStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkCopyfrom(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c34(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c33)),s0}function peg$parseJumpStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkJump(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseLabel(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c36(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c35)),s0}function peg$parseJumpzStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkJumpz(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseLabel(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c38(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c37)),s0}function peg$parseJumpnStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkJumpn(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseLabel(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c40(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c39)),s0}function peg$parseCommentStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkComment(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseDirectArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c42(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c41)),s0}function peg$parseDefineLabelStatement(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkDefine(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parsetkLabel(),s3!==peg$FAILED?(s4=peg$parse__(),s4!==peg$FAILED?(s5=peg$parseDirectArgument(),s5!==peg$FAILED?(s6=peg$parse_(),s6!==peg$FAILED?(s7=peg$parseLineTerminatorSequence(),s7!==peg$FAILED?(s8=peg$parse__(),s8!==peg$FAILED?(s9=peg$parseBase64Data(),s9!==peg$FAILED?(peg$savedPos=s0,s1=peg$c44(s5,s9),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c43)),s0}function peg$parseDefineCommentStatement(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkDefine(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parsetkComment(),s3!==peg$FAILED?(s4=peg$parse__(),s4!==peg$FAILED?(s5=peg$parseDirectArgument(),s5!==peg$FAILED?(s6=peg$parse_(),s6!==peg$FAILED?(s7=peg$parseLineTerminatorSequence(),s7!==peg$FAILED?(s8=peg$parse__(),s8!==peg$FAILED?(s9=peg$parseBase64Data(),s9!==peg$FAILED?(peg$savedPos=s0,s1=peg$c46(s5,s9),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c45)),s0}function peg$parseBase64Data(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,s1=peg$parseBase64(),s1!==peg$FAILED?(59===input.charCodeAt(peg$currPos)?(s2=peg$c48,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c49)),s2!==peg$FAILED?(peg$savedPos=s0,s1=peg$c50(s1),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c47)),s0}function peg$parseReservedWord(){var s0;return s0=peg$parsetkInbox(),s0===peg$FAILED&&(s0=peg$parsetkOutbox(),s0===peg$FAILED&&(s0=peg$parsetkCopyfrom(),s0===peg$FAILED&&(s0=peg$parsetkCopyto(),s0===peg$FAILED&&(s0=peg$parsetkAdd(),s0===peg$FAILED&&(s0=peg$parsetkSub(),s0===peg$FAILED&&(s0=peg$parsetkBumpup(),s0===peg$FAILED&&(s0=peg$parsetkBumpdn(),s0===peg$FAILED&&(s0=peg$parsetkJump(),s0===peg$FAILED&&(s0=peg$parsetkJumpz(),s0===peg$FAILED&&(s0=peg$parsetkJumpn(),s0===peg$FAILED&&(s0=peg$parsetkDefine(),s0===peg$FAILED&&(s0=peg$parsetkComment(),s0===peg$FAILED&&(s0=peg$parsetkLabel()))))))))))))),s0}function peg$parsetkInbox(){var s0;return input.substr(peg$currPos,5)===peg$c51?(s0=peg$c51,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c52)),s0}function peg$parsetkOutbox(){var s0;return input.substr(peg$currPos,6)===peg$c53?(s0=peg$c53,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c54)),s0}function peg$parsetkCopyto(){var s0;return input.substr(peg$currPos,6)===peg$c55?(s0=peg$c55,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c56)),s0}function peg$parsetkCopyfrom(){var s0;return input.substr(peg$currPos,8)===peg$c57?(s0=peg$c57,peg$currPos+=8):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c58)),s0}function peg$parsetkAdd(){var s0;return input.substr(peg$currPos,3)===peg$c59?(s0=peg$c59,peg$currPos+=3):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c60)),s0}function peg$parsetkSub(){var s0;return input.substr(peg$currPos,3)===peg$c61?(s0=peg$c61,peg$currPos+=3):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c62)),s0}function peg$parsetkBumpup(){var s0;return input.substr(peg$currPos,6)===peg$c63?(s0=peg$c63,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c64)),s0}function peg$parsetkBumpdn(){var s0;return input.substr(peg$currPos,6)===peg$c65?(s0=peg$c65,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c66)),s0}function peg$parsetkJump(){var s0;return input.substr(peg$currPos,4)===peg$c67?(s0=peg$c67,peg$currPos+=4):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c68)),s0}function peg$parsetkJumpz(){var s0;return input.substr(peg$currPos,5)===peg$c69?(s0=peg$c69,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c70)),s0}function peg$parsetkJumpn(){var s0;return input.substr(peg$currPos,5)===peg$c71?(s0=peg$c71,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c72)),s0}function peg$parsetkDefine(){var s0;return input.substr(peg$currPos,6)===peg$c73?(s0=peg$c73,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s0}function peg$parsetkComment(){var s0;return input.substr(peg$currPos,7)===peg$c75?(s0=peg$c75,peg$currPos+=7):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c76)),s0}function peg$parsetkLabel(){var s0;return input.substr(peg$currPos,5)===peg$c77?(s0=peg$c77,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s0}function peg$parseDigit(){var s0;return peg$c79.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c80)),s0}function peg$parseLetter(){var s0;return peg$c81.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82)),s0}function peg$parseBase64(){var s0,s1,s2;if(s0=peg$currPos,s1=[],peg$c83.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),peg$c83.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84));else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c85(s1)),s0=s1}function peg$parseComment(){var s0,s1,s2,s3,s4,s5;if(peg$silentFails++,s0=peg$currPos,input.substr(peg$currPos,2)===peg$c87?(s1=peg$c87,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c88)),s1!==peg$FAILED){for(s2=[],s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseLineTerminator(),peg$silentFails--,s5===peg$FAILED?s4=void 0:(peg$currPos=s4,s4=peg$FAILED),s4!==peg$FAILED?(input.length>peg$currPos?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c89)),s5!==peg$FAILED?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$FAILED)):(peg$currPos=s3,s3=peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseLineTerminator(),peg$silentFails--,s5===peg$FAILED?s4=void 0:(peg$currPos=s4,s4=peg$FAILED),s4!==peg$FAILED?(input.length>peg$currPos?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c89)),s5!==peg$FAILED?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$FAILED)):(peg$currPos=s3,s3=peg$FAILED);s2!==peg$FAILED?(s1=[s1,s2],s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c86)),s0}function peg$parseWs(){var s0,s1;return peg$silentFails++,32===input.charCodeAt(peg$currPos)?(s0=peg$c91,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c92)),s0===peg$FAILED&&(9===input.charCodeAt(peg$currPos)?(s0=peg$c93,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c94))),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c90)),s0}function peg$parseLineTerminator(){var s0;return peg$c95.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c96)),s0}function peg$parseLineTerminatorSequence(){var s0,s1;return peg$silentFails++,input.substr(peg$currPos,2)===peg$c98?(s0=peg$c98,peg$currPos+=2):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c99)),s0===peg$FAILED&&(10===input.charCodeAt(peg$currPos)?(s0=peg$c100,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c101))),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c97)),s0}function peg$parseEOF(){var s0,s1;return s0=peg$currPos,
peg$silentFails++,input.length>peg$currPos?(s1=input.charAt(peg$currPos),peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c89)),peg$silentFails--,s1===peg$FAILED?s0=void 0:(peg$currPos=s0,s0=peg$FAILED),s0}function peg$parse_(){var s0,s1;for(s0=[],s1=peg$parseWs();s1!==peg$FAILED;)s0.push(s1),s1=peg$parseWs();return s0}function peg$parse__(){var s0,s1;for(s0=[],s1=peg$parseWs(),s1===peg$FAILED&&(s1=peg$parseComment(),s1===peg$FAILED&&(s1=peg$parseLineTerminatorSequence()));s1!==peg$FAILED;)s0.push(s1),s1=peg$parseWs(),s1===peg$FAILED&&(s1=peg$parseComment(),s1===peg$FAILED&&(s1=peg$parseLineTerminatorSequence()));return s0}function extractList(list,index){var i,result=new Array(list.length);for(i=0;i<list.length;i++)result[i]=list[i][index];return result}function buildList(head,tail,index){return[head].concat(extractList(tail,index))}function optionalList(value){return null!==value?value:[]}var peg$result,options=arguments.length>1?arguments[1]:{},peg$FAILED={},peg$startRuleFunctions={Start:peg$parseStart},peg$startRuleFunction=peg$parseStart,peg$c0=function(program){return program},peg$c1=function(body){return{statements:optionalList(body)}},peg$c2=function(head,tail){return buildList(head,tail,1)},peg$c3=function(s){return s},peg$c4=function(s){return s},peg$c5={type:"other",description:"label statement"},peg$c6=":",peg$c7={type:"literal",value:":",description:'":"'},peg$c8=function(label){return new commands.Label(location(),label)},peg$c9={type:"other",description:"argument"},peg$c10=function(a){return{type:"Identifier",name:a.join("")}},peg$c11={type:"other",description:"indirect argument"},peg$c12="[",peg$c13={type:"literal",value:"[",description:'"["'},peg$c14="]",peg$c15={type:"literal",value:"]",description:'"]"'},peg$c16=function(a){return{type:"IndirectIdentifier",name:a.join("")}},peg$c17={type:"other",description:"label"},peg$c18=function(head,tail){var name=head+tail.join("");return/(IN|OUT)BOX|COPY(FROM|TO)|ADD|SUB|BUMP(UP|DN)|JUMP(N|Z)?|DEFINE|LABEL|COMMENT/.test(name)&&error("Expected label, but keyword "+name+" found"),name},peg$c19={type:"other",description:"INBOX"},peg$c20=function(){return new commands.Inbox(location())},peg$c21={type:"other",description:"OUTBOX"},peg$c22=function(){return new commands.Outbox(location())},peg$c23={type:"other",description:"ADD"},peg$c24=function(arg){return new commands.Add(location(),arg)},peg$c25={type:"other",description:"SUB"},peg$c26=function(arg){return new commands.Sub(location(),arg)},peg$c27={type:"other",description:"BUMPUP"},peg$c28=function(arg){return new commands.Bumpup(location(),arg)},peg$c29={type:"other",description:"BUMPDN"},peg$c30=function(arg){return new commands.Bumpdn(location(),arg)},peg$c31={type:"other",description:"COPYTO"},peg$c32=function(arg){return new commands.Copyto(location(),arg)},peg$c33={type:"other",description:"COPYFROM"},peg$c34=function(arg){return new commands.Copyfrom(location(),arg)},peg$c35={type:"other",description:"JUMP"},peg$c36=function(label){return new commands.Jump(location(),label)},peg$c37={type:"other",description:"JUMPZ"},peg$c38=function(label){return new commands.Jumpz(location(),label)},peg$c39={type:"other",description:"JUMPN"},peg$c40=function(label){return new commands.Jumpn(location(),label)},peg$c41={type:"other",description:"COMMENT Reference"},peg$c42=function(ref){return new commands.Comment(location(),ref.name)},peg$c43={type:"other",description:"DEFINE LABEL"},peg$c44=function(ref,data){return new commands.Define(location(),"label",ref.name,data)},peg$c45={type:"other",description:"DEFINE COMMENT"},peg$c46=function(ref,data){return new commands.Define(location(),"comment",ref.name,data)},peg$c47={type:"other",description:"base64"},peg$c48=";",peg$c49={type:"literal",value:";",description:'";"'},peg$c50=function(b64){return b64},peg$c51="INBOX",peg$c52={type:"literal",value:"INBOX",description:'"INBOX"'},peg$c53="OUTBOX",peg$c54={type:"literal",value:"OUTBOX",description:'"OUTBOX"'},peg$c55="COPYTO",peg$c56={type:"literal",value:"COPYTO",description:'"COPYTO"'},peg$c57="COPYFROM",peg$c58={type:"literal",value:"COPYFROM",description:'"COPYFROM"'},peg$c59="ADD",peg$c60={type:"literal",value:"ADD",description:'"ADD"'},peg$c61="SUB",peg$c62={type:"literal",value:"SUB",description:'"SUB"'},peg$c63="BUMPUP",peg$c64={type:"literal",value:"BUMPUP",description:'"BUMPUP"'},peg$c65="BUMPDN",peg$c66={type:"literal",value:"BUMPDN",description:'"BUMPDN"'},peg$c67="JUMP",peg$c68={type:"literal",value:"JUMP",description:'"JUMP"'},peg$c69="JUMPZ",peg$c70={type:"literal",value:"JUMPZ",description:'"JUMPZ"'},peg$c71="JUMPN",peg$c72={type:"literal",value:"JUMPN",description:'"JUMPN"'},peg$c73="DEFINE",peg$c74={type:"literal",value:"DEFINE",description:'"DEFINE"'},peg$c75="COMMENT",peg$c76={type:"literal",value:"COMMENT",description:'"COMMENT"'},peg$c77="LABEL",peg$c78={type:"literal",value:"LABEL",description:'"LABEL"'},peg$c79=/^[0-9]/,peg$c80={type:"class",value:"[0-9]",description:"[0-9]"},peg$c81=/^[a-zA-Z]/,peg$c82={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},peg$c83=/^[A-Za-z0-9+\/=\r\n\t ]/,peg$c84={type:"class",value:"[A-Za-z0-9+\\/=\\r\\n\\t ]",description:"[A-Za-z0-9+\\/=\\r\\n\\t ]"},peg$c85=function(b64){return b64.join("").replace(/[\r\n\t ]/g,"")},peg$c86={type:"other",description:"comment"},peg$c87="--",peg$c88={type:"literal",value:"--",description:'"--"'},peg$c89={type:"any",description:"any character"},peg$c90={type:"other",description:"whitespace"},peg$c91=" ",peg$c92={type:"literal",value:" ",description:'" "'},peg$c93="	",peg$c94={type:"literal",value:"	",description:'"\\t"'},peg$c95=/^[\r\n]/,peg$c96={type:"class",value:"[\\r\\n]",description:"[\\r\\n]"},peg$c97={type:"other",description:"end of line"},peg$c98="\r\n",peg$c99={type:"literal",value:"\r\n",description:'"\\r\\n"'},peg$c100="\n",peg$c101={type:"literal",value:"\n",description:'"\\n"'},peg$currPos=0,peg$savedPos=0,peg$posDetailsCache=[{line:1,column:1,seenCR:!1}],peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0;if("startRule"in options){if(!(options.startRule in peg$startRuleFunctions))throw new Error("Can't start parsing from rule \""+options.startRule+'".');peg$startRuleFunction=peg$startRuleFunctions[options.startRule]}var commands=require("../lib/hrm-commands.js");if(peg$result=peg$startRuleFunction(),peg$result!==peg$FAILED&&peg$currPos===input.length)return peg$result;throw peg$result!==peg$FAILED&&peg$currPos<input.length&&peg$fail({type:"end",description:"end of input"}),peg$buildException(null,peg$maxFailExpected,peg$maxFailPos<input.length?input.charAt(peg$maxFailPos):null,peg$maxFailPos<input.length?peg$computeLocation(peg$maxFailPos,peg$maxFailPos+1):peg$computeLocation(peg$maxFailPos,peg$maxFailPos))}return peg$subclass(peg$SyntaxError,Error),{SyntaxError:peg$SyntaxError,parse:peg$parse}}()},{"../lib/hrm-commands.js":11}],10:[function(require,module,exports){"use strict";var strict=require("./build/hrm.js"),commands=require("./lib/hrm-commands.js");module.exports={parser:strict,commands:commands}},{"./build/hrm.js":9,"./lib/hrm-commands.js":11}],11:[function(require,module,exports){"use strict";var Inbox=(require("util"),function(location){return this instanceof Inbox?(this.type="inbox",void(this._location=location)):new Inbox(location)}),Outbox=function(location){return this instanceof Outbox?(this.type="outbox",void(this._location=location)):new Outbox(location)},Copyfrom=function(location,arg){return this instanceof Copyfrom?(this.type="copyfrom",this.arg=arg,void(this._location=location)):new Copyfrom(location,arg)},Copyto=function(location,arg){return this instanceof Copyto?(this.type="copyto",this.arg=arg,void(this._location=location)):new Copyto(location,arg)},Add=function(location,arg){return this instanceof Add?(this.type="add",this.arg=arg,void(this._location=location)):new Add(location,arg)},Sub=function(location,arg){return this instanceof Sub?(this.type="sub",this.arg=arg,void(this._location=location)):new Sub(location,arg)},Bumpup=function(location,arg){return this instanceof Bumpup?(this.type="bumpup",this.arg=arg,void(this._location=location)):new Bumpup(location,arg)},Bumpdn=function(location,arg){return this instanceof Bumpdn?(this.type="bumpdn",this.arg=arg,void(this._location=location)):new Bumpdn(location,arg)},Jump=function(location,label){return this instanceof Jump?(this.type="jump",this.label=label,void(this._location=location)):new Jump(location,label)},Jumpz=function(location,label){return this instanceof Jumpz?(this.type="jumpz",this.label=label,void(this._location=location)):new Jumpz(location,label)},Jumpn=function(location,label){return this instanceof Jumpn?(this.type="jumpn",this.label=label,void(this._location=location)):new Jumpn(location,label)},Comment=function(location,ref){return this instanceof Comment?(this.type="comment",this.ref=ref,void(this._location=location)):new Comment(location,ref)},Define=function(location,what,ref,data){return this instanceof Define?(this.type="define",this.what=what,this.ref=ref,this.data=data,void(this._location=location)):new Define(location,what,ref,data)},Label=function(location,label){return this instanceof Label?(this.type="label",this.label=label,void(this._location=location)):new Label(location,label)};module.exports={Inbox:Inbox,Outbox:Outbox,Copyfrom:Copyfrom,Copyto:Copyto,Add:Add,Sub:Sub,Bumpup:Bumpup,Bumpdn:Bumpdn,Jump:Jump,Jumpz:Jumpz,Jumpn:Jumpn,Comment:Comment,Define:Define,Label:Label}},{util:8}]},{},[1]);var DELAY_MS_UPDATE_CODEVIEWER=250,UI_STATE_STOPPED=0,UI_STATE_STARTING=1,UI_STATE_RUNNING=2,UI_STATE_STEPPED=3,UI_STATE_BREAK=4,Controller=function(editorId){return this instanceof Controller?(this.uiState=UI_STATE_STOPPED,this.program=void 0,this.state=void 0,this.breakpoints=[],this.selectedSpeed=300,this.shouldRenderCodeView=!0,this.lastUiState=void 0,this.lastMarkedText=void 0,void this.setEditor(editorId)):new Controller(editorId)},CP=Controller.prototype;CP.setEditor=function(eltId){function makeMarker(){var marker=document.createElement("div");return marker.style.color="#822",marker.innerHTML="●",marker}var self=this;this.editor=CodeMirror.fromTextArea(document.getElementById(eltId),{mode:"hrm",lineNumbers:!0,styleActiveLine:!0,viewportMargin:1/0,gutters:["CodeMirror-linenumbers","breakpoints"]});var oldCode="";this.editor.on("change",function(e){var currentCode=self.editor.getValue();currentCode!=oldCode&&(oldCode=currentCode,self.shouldRenderCodeView=!0)}),this.editor.on("gutterClick",function(cm,n){var info=cm.lineInfo(n);cm.setGutterMarker(n,"breakpoints",info.gutterMarkers?null:makeMarker()),self.toggleBreakpoint(info.line)})},CP.setCodeViewer=function(eltId,$modal){var self=this;this.hrmv=void 0,this.viewCode=debounce(function(code){self.hrmv=new HRMViewer(eltId,code)},DELAY_MS_UPDATE_CODEVIEWER,!1);var vv=!0;$("#view").on("click",function(e){vv?(vv=!1,self.shouldRenderCodeView?(self.shouldRenderCodeView=!1,self.viewCode(self.editor.getValue())):void 0!==self.hrmv,$("#code-view").toggleClass("hidden",!1)):(vv=!0,$("#code-view").toggleClass("hidden",!0))})},CP.toggleBreakpoint=function(bp){bp+=1;var idx=this.breakpoints.indexOf(bp);0>idx?this.breakpoints.push(bp):this.breakpoints.splice(idx,1),this.assignBreakpoints()},CP.assignBreakpoints=function(){this.program&&this.program.setBreakpoints(this.breakpoints)},CP.parseSource=function(){function readInbox($inbox){return $inbox.val().split(/[, \t\n\"']/).filter(function(v){return v.trim().length>0}).map(function(s){var n=Number(s);return Number.isNaN(n)?s:n})}try{var inbox=readInbox($("#inbox")),variables=$.parseJSON($("#variables").val());this.state=new HrmProgramState({inbox:inbox,variables:variables});var source=this.editor.getValue();return this.program=HrmProgram.parse(source),this.assignBreakpoints(),this.updateUI(this.state,UI_STATE_STARTING),!0}catch(error){console.error(error),this.onErrorCaught(error)}return!1},CP.step=function(nextUiState){nextUiState=nextUiState||UI_STATE_RUNNING;try{var done=!1,step=this.program.step(this.state);step?"break"===step&&(this.intervalId&&clearInterval(this.intervalId),nextUiState=UI_STATE_BREAK):(this.intervalId&&clearInterval(this.intervalId),done=!0,nextUiState=UI_STATE_STOPPED),this.updateUI(this.state,nextUiState),done&&(this.program=void 0,this.state=void 0)}catch(error){console.error(error),this.intervalId&&clearInterval(this.intervalId),this.onErrorCaught(error)}},CP.runSteps=function(speed){var self=this;this.intervalId=void 0,speed?this.intervalId=setInterval(function(){self.step()},speed):this.step(UI_STATE_STEPPED)},CP.runToEnd=function(){var nextUiState=UI_STATE_RUNNING;try{var done=!1,step=this.program.resume(this.state);step?"break"===step&&(nextUiState=UI_STATE_BREAK):(nextUiState=UI_STATE_STOPPED,done=!0),this.updateUI(this.state,nextUiState),done&&(this.program=void 0,this.state=void 0)}catch(error){console.error(error),this.onErrorCaught(error)}},CP.pause=function(){var nextUiState=UI_STATE_STEPPED;this.uiState==UI_STATE_RUNNING&&void 0!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.updateUI(this.state,nextUiState))},CP.stop=function(){this.uiState==UI_STATE_RUNNING&&void 0!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0),this.program=void 0,this.state=void 0,this.updateUI(this.state,UI_STATE_STOPPED)},CP.onErrorCaught=function(error){this.updateUI(this.state,UI_STATE_STOPPED),$("#error").toggleClass("hidden",!1),$("#error-content").empty();var loc;error.name&&"SyntaxError"===error.name?error.location?(loc=error.location,$("#error-content").append("<b>Error parsing HRM program, aborted.</b><br />Line "+loc.start.line+" Column "+loc.start.column+"<br />"+error.message),this.editor.setCursor(loc.start.line-1),this.lastMark&&this.lastMark.clear(),this.lastMark=this.editor.markText({line:loc.start.line-1,ch:loc.start.column-1},{line:loc.end.line-1,ch:loc.end.column-1},{className:"line-error"})):$("#error-content").append("<b>Error parsing HRM program, aborted.</b><br />"+error.message):($("#error-content").append("<b>Error running HRM program, aborted.</b><br />"+error.message),this.state&&(this.state.ip--,loc=this.locFromState(this.state),this.editor.setCursor(loc.start.line),this.lastMark&&this.lastMark.clear(),this.lastMark=this.editor.markText({line:loc.start.line,ch:loc.start.column},{line:loc.end.line,ch:loc.end.column},{className:"line-error"}))),this.program=void 0,this.state=void 0};var ELT_WRAPPER_NUMBER='<span class="label label-success">',ELT_WRAPPER_ALPHA='<span class="label label-primary">';CP.updateUI=function(hrmState,nextUiState){if(this.uiState=nextUiState,this.lastUiState!==this.uiState){switch(this.lastUiState=this.uiState,this.uiState){case UI_STATE_STARTING:case UI_STATE_RUNNING:case UI_STATE_STEPPED:$("#edit-state").toggleClass("active",!0),$("#edit-state").toggleClass("progress-bar-striped",!0),$("#edit-state").toggleClass("progress-bar-success",!0),$("#edit-state").toggleClass("progress-bar-warning",!1);break;case UI_STATE_STOPPED:$("#edit-state").toggleClass("active",!1),$("#edit-state").toggleClass("progress-bar-striped",!1),$("#edit-state").toggleClass("progress-bar-success",!1),$("#edit-state").toggleClass("progress-bar-warning",!1);break;case UI_STATE_BREAK:$("#edit-state").toggleClass("active",!0),$("#edit-state").toggleClass("progress-bar-striped",!0),$("#edit-state").toggleClass("progress-bar-success",!1),$("#edit-state").toggleClass("progress-bar-warning",!0)}switch(this.uiState){case UI_STATE_STARTING:$("#error").toggleClass("hidden",!0),$("#error-content").empty()}switch(this.uiState){case UI_STATE_STOPPED:this.editor.setOption("readOnly",!1);break;case UI_STATE_STARTING:case UI_STATE_BREAK:case UI_STATE_RUNNING:case UI_STATE_STEPPED:this.editor.setOption("readOnly",!0)}switch(this.uiState){case UI_STATE_STOPPED:$("#run").prop("disabled",!1),$("#runToEnd").prop("disabled",!1),$("#stepInto").prop("disabled",!1),$("#pause").prop("disabled",!0),$("#stop").prop("disabled",!0);break;case UI_STATE_BREAK:case UI_STATE_STEPPED:$("#run").prop("disabled",!1),$("#runToEnd").prop("disabled",!1),$("#stepInto").prop("disabled",!1),$("#pause").prop("disabled",!0),$("#stop").prop("disabled",!1);break;case UI_STATE_RUNNING:$("#run").prop("disabled",!0),$("#runToEnd").prop("disabled",!0),$("#stepInto").prop("disabled",!0),$("#pause").prop("disabled",!1),$("#stop").prop("disabled",!1);break;case UI_STATE_STARTING:$("#run").prop("disabled",!0),$("#runToEnd").prop("disabled",!0),$("#stepInto").prop("disabled",!0),$("#pause").prop("disabled",!0),$("#stop").prop("disabled",!0)}}var line=void 0!==hrmState?this.lineFromState(hrmState):0;if(this.editor.setCursor(line),this.lastMark&&(this.lastMark.clear(),this.lastMark=void 0),void 0!==hrmState&&hrmState.isAtBreakpoint){var loc=this.locFromState(hrmState);this.lastMark=this.editor.markText({line:loc.start.line,ch:loc.start.column},{line:loc.end.line,ch:loc.end.column},{className:"line-breakpoint"})}if(void 0!==this.hrmv&&this.hrmv.setActiveLine(line),$("#stats").empty(),void 0!==hrmState&&$("#stats").append("iterations: "+(hrmState.iterations-hrmState.labelsHit)),$("#outbox").empty(),void 0!==hrmState)for(var ii=hrmState.outbox.length-1;ii>=0;--ii){var isNumber="number"==typeof hrmState.outbox[ii],wrapper=isNumber?ELT_WRAPPER_NUMBER:ELT_WRAPPER_ALPHA;$("#outbox").append($("<li>").append($(wrapper).append(hrmState.outbox[ii].toString())))}},CP.bindVisuals=function(){var self=this;$("div.split-pane").splitPane(),$("#run").on("click",function(){switch(self.uiState){case UI_STATE_STOPPED:self.parseSource()&&self.runSteps(self.selectedSpeed);break;case UI_STATE_BREAK:case UI_STATE_STEPPED:self.runSteps(self.selectedSpeed)}}),$("#runToEnd").on("click",function(){switch(self.uiState){case UI_STATE_STOPPED:self.parseSource()&&self.runToEnd();break;case UI_STATE_BREAK:case UI_STATE_STEPPED:self.runToEnd()}}),$("#stepInto").on("click",function(){switch(self.uiState){case UI_STATE_STOPPED:self.parseSource()&&self.step(UI_STATE_STEPPED);break;case UI_STATE_BREAK:case UI_STATE_STEPPED:self.step(UI_STATE_STEPPED)}}),$("#pause").on("click",function(){switch(self.uiState){case UI_STATE_RUNNING:self.pause()}}),$("#stop").on("click",function(){switch(self.uiState){case UI_STATE_RUNNING:case UI_STATE_BREAK:case UI_STATE_STEPPED:self.stop()}})},CP.lineFromState=function(s){return this.program&&s.ip>=0&&s.ip<this.program._program.statements.length?this.program._program.statements[s.ip]._location.start.line-1:0},CP.locFromState=function(s){if(this.program&&s.ip>=0&&s.ip<this.program._program.statements.length){var l=this.program._program.statements[s.ip]._location;return{start:{line:l.start.line-1,column:0},end:{line:l.end.line-1,column:l.end.column-1}}}return{start:{},end:{}}};